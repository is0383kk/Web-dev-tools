"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[361],{8742:(e,r,a)=>{a.r(r),a.d(r,{StoryMapDnD:()=>b});var d=a(5155),n=a(4055),l=a(937),s=a(5686),o=a(3473),i=a(7530),t=a(2115);let c={epic:"story",story:"task",task:"subtask",subtask:null};function p(e){return 1===e?"bg-white border-gray-200 dark:bg-zinc-950 dark:border-zinc-700":2===e?"bg-gray-50 border-gray-200 dark:bg-zinc-900 dark:border-zinc-700":3===e?"bg-gray-100 border-gray-300 dark:bg-zinc-800 dark:border-zinc-600":"bg-gray-150 border-gray-200 dark:bg-zinc-700 dark:border-zinc-600"}function b(e){let{items:r,setItems:a,selected:b,setSelected:g}=e,u=(0,t.useMemo)(()=>r.filter(e=>"epic"===e.type).map(e=>({...e,stories:r.filter(r=>"story"===r.type&&r.parentId===e.id).map(e=>({...e,tasks:r.filter(r=>"task"===r.type&&r.parentId===e.id).map(e=>({...e,subtasks:r.filter(r=>"subtask"===r.type&&r.parentId===e.id)}))}))})),[r]),x=(0,t.useMemo)(()=>(function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,a=[];for(let d=0;d<e.length;d+=r)a.push(e.slice(d,d+r));return a})(u),[u]);function f(e){var d,n,l;let s=c[e.type];s&&a([...r,{id:null!==(l=null===(n=crypto)||void 0===n?void 0:null===(d=n.randomUUID)||void 0===d?void 0:d.call(n))&&void 0!==l?l:"".concat(s,"-").concat(Date.now()).concat(1e3*Math.random()),type:s,parentId:e.id,title:"タイトル"}])}function h(e){let d=[e.id,...function e(r,a){return a.filter(e=>e.parentId===r).flatMap(r=>[r.id,...e(r.id,a)])}(e.id,r)];a(r.filter(e=>!d.includes(e.id))),b&&d.includes(b.id)&&g(null)}let v=(e,d)=>a(r.map(r=>r.id===e?{...r,title:d}:r));return(0,d.jsx)(n.JY,{onDragEnd:function(e){if(!e.destination)return;let{draggableId:d,source:n,destination:l,type:s}=e;if("epic"===s){let e=parseInt(n.droppableId.split("-").pop(),10),d=parseInt(l.droppableId.split("-").pop(),10),s=3*e+n.index,o=3*d+l.index,i=r.filter(e=>"epic"===e.type),[t]=i.splice(s,1);i.splice(o,0,t),a([...i,...r.filter(e=>"epic"!==e.type)]);return}let o=r.find(e=>e.id===d);if(!o)return;let i=n.droppableId,t=l.droppableId,c=r.filter(e=>e.type===s&&e.parentId===i),p=r.filter(e=>e.type===s&&e.parentId===t);if(i===t){let e=[...c],[d]=e.splice(n.index,1);e.splice(l.index,0,d),a([...r.filter(e=>!(e.type===s&&e.parentId===i)),...e])}else{let e={...o,parentId:t};c.splice(n.index,1),p.splice(l.index,0,e),a([...r.filter(e=>!(e.type===s&&(e.parentId===i||e.parentId===t))),...c,...p])}},children:x.map((e,r)=>(0,d.jsx)(n.gL,{droppableId:"epic-row-".concat(r),type:"epic",direction:"horizontal",children:a=>(0,d.jsxs)("div",{ref:a.innerRef,...a.droppableProps,className:"flex gap-6 mb-6",children:[e.map((e,a)=>(0,d.jsx)(n.sx,{draggableId:e.id,index:a,children:t=>(0,d.jsxs)("div",{ref:t.innerRef,...t.draggableProps,className:"".concat(p(1)," p-2 rounded shadow border flex flex-col gap-3 w-full"),children:[(0,d.jsxs)("div",{className:"mb-2 flex items-center gap-1",children:[(0,d.jsxs)(l.JU,{className:"text-lg font-bold",children:[3*r+a+1,"．"]}),(0,d.jsx)("input",{className:"flex-1 px-2 py-1 rounded bg-transparent border-b outline-none focus:bg-cyan-100 dark:focus:bg-yellow-800 font-bold",value:e.title,onChange:r=>{let a=r.target.value.match(/^\d+\.\s*(.*)$/),d=a?a[1]:r.target.value;v(e.id,d)},onFocus:()=>g(e)}),(0,d.jsx)("button",{onClick:r=>{r.stopPropagation(),h(e)},className:"p-1 rounded hover:bg-red-200 dark:hover:bg-red-700",title:"削除",children:(0,d.jsx)(s.A,{size:18})}),(0,d.jsx)("button",{onClick:()=>f(e),className:"p-1 rounded hover:bg-green-200 dark:hover:bg-green-700",title:"子ストーリーを追加",children:(0,d.jsx)(o.A,{size:18})}),(0,d.jsx)("div",{...t.dragHandleProps,tabIndex:-1,className:"ml-1 cursor-grab p-1 rounded focus:bg-cyan-100 dark:hover:bg-yellow-700 active:cursor-grabbing",title:"ドラッグで移動",children:(0,d.jsx)(i.A,{size:18})})]}),(0,d.jsx)(n.gL,{droppableId:e.id,type:"story",children:r=>{var a;return(0,d.jsxs)("div",{ref:r.innerRef,...r.droppableProps,className:"min-h-[36px]",children:[null===(a=e.stories)||void 0===a?void 0:a.map((e,r)=>(0,d.jsx)(n.sx,{draggableId:e.id,index:r,children:r=>(0,d.jsxs)("div",{ref:r.innerRef,...r.draggableProps,className:"".concat(p(2)," mb-3 p-2 rounded shadow border flex flex-col gap-3"),onClick:r=>{r.stopPropagation(),g(e)},children:[(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsx)("input",{className:"flex-1 px-2 py-1 rounded bg-transparent border-b outline-none focus:bg-cyan-100 dark:focus:bg-yellow-800 font-bold",value:e.title,onChange:r=>v(e.id,r.target.value),onFocus:()=>g(e)}),(0,d.jsx)("button",{onClick:r=>{r.stopPropagation(),h(e)},className:"p-1 rounded hover:bg-red-200 dark:hover:bg-red-700",title:"エピックを削除",children:(0,d.jsx)(s.A,{size:18})}),(0,d.jsx)("button",{onClick:()=>f(e),className:"p-1 rounded hover:bg-green-200 dark:hover:bg-green-700",title:"子タスクを追加",children:(0,d.jsx)(o.A,{size:18})}),(0,d.jsx)("div",{...r.dragHandleProps,tabIndex:-1,className:"ml-1 cursor-grab p-1 rounded focus:bg-cyan-100 dark:hover:bg-yellow-700 active:cursor-grabbing",title:"ドラッグで移動",children:(0,d.jsx)(i.A,{size:18})})]}),(0,d.jsx)(n.gL,{droppableId:e.id,type:"task",children:r=>{var a;return(0,d.jsxs)("div",{ref:r.innerRef,...r.droppableProps,className:"ml-0 min-h-[36px]",children:[null===(a=e.tasks)||void 0===a?void 0:a.map((e,r)=>(0,d.jsx)(n.sx,{draggableId:e.id,index:r,children:r=>(0,d.jsxs)("div",{ref:r.innerRef,...r.draggableProps,className:"".concat(p(3)," mb-3 p-2 rounded shadow border flex flex-col gap-3"),onClick:r=>{r.stopPropagation(),g(e)},children:[(0,d.jsxs)("div",{className:"flex items-center gap-1 text-sm",children:[(0,d.jsx)("input",{className:"flex-1 px-2 py-1 rounded bg-transparent border-b outline-none focus:bg-cyan-100 dark:focus:bg-yellow-800 font-bold",value:e.title,onChange:r=>v(e.id,r.target.value),onFocus:()=>g(e)}),(0,d.jsx)("button",{onClick:r=>{r.stopPropagation(),h(e)},className:"p-1 rounded hover:bg-red-200 dark:hover:bg-red-700",title:"エピックを削除",children:(0,d.jsx)(s.A,{size:18})}),(0,d.jsx)("button",{onClick:()=>f(e),className:"p-1 rounded hover:bg-green-200 dark:hover:bg-green-700",title:"子サブタスクを追加",children:(0,d.jsx)(o.A,{size:16})}),(0,d.jsx)("div",{...r.dragHandleProps,tabIndex:-1,className:"ml-1 cursor-grab p-1 rounded hover:focus:bg-cyan-100 dark:hover:bg-yellow-700 active:cursor-grabbing",title:"ドラッグで移動",children:(0,d.jsx)(i.A,{size:16})})]}),(0,d.jsx)(n.gL,{droppableId:e.id,type:"subtask",children:r=>{var a;return(0,d.jsxs)("div",{ref:r.innerRef,...r.droppableProps,className:"ml-0 min-h-[36px]",children:[null===(a=e.subtasks)||void 0===a?void 0:a.map((e,r)=>(0,d.jsx)(n.sx,{draggableId:e.id,index:r,children:r=>(0,d.jsxs)("div",{ref:r.innerRef,...r.draggableProps,className:"".concat(p(4)," mb-3 p-2 rounded shadow border flex items-center gap-1 text-xs"),onClick:r=>{r.stopPropagation(),g(e)},children:[(0,d.jsx)("input",{className:"flex-1 px-2 py-1 rounded bg-transparent border-b outline-none focus:bg-cyan-100 dark:focus:bg-yellow-800 font-bold",value:e.title,onChange:r=>v(e.id,r.target.value),onFocus:()=>g(e)}),(0,d.jsx)("button",{onClick:r=>{r.stopPropagation(),h(e)},className:"p-1 rounded hover:bg-red-200 dark:hover:bg-red-700",title:"サブタスクを削除",children:(0,d.jsx)(s.A,{size:14})}),(0,d.jsx)("div",{...r.dragHandleProps,tabIndex:-1,className:"cursor-grab p-1 rounded focus:bg-cyan-100 dark:hover:bg-yellow-700 active:cursor-grabbing",title:"ドラッグで移動",children:(0,d.jsx)(i.A,{size:14})})]})},e.id)),r.placeholder]})}})]})},e.id)),r.placeholder]})}})]})},e.id)),r.placeholder]})}})]})},e.id)),a.placeholder]})},r))})}}}]);